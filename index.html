
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>User Manuals Portal</title>

  <style>
    /* =========================
       THEME SYSTEM (Light/Dark)
       ========================= */
    :root { color-scheme: light dark; }
    :root[data-theme="dark"] {
      --bg: #0f172a;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --brand: #4f46e5;         /* TODO: your brand color, e.g., #3B82F6 */
      --border: #1f2937;
      --link: #60a5fa;
      --success: #10b981;
      --danger: #ef4444;
      --shadow: 0 8px 24px rgba(0,0,0,0.35);
    }
    :root[data-theme="light"] {
      --bg: #f5f7fb;
      --panel: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --brand: #4f46e5;         /* TODO: your brand color */
      --border: #e5e7eb;
      --link: #1d4ed8;
      --success: #0f766e;
      --danger: #dc2626;
      --shadow: 0 8px 24px rgba(0,0,0,0.08);
    }

    /* Reset + Base */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(11,19,36,0.15), transparent),
        var(--bg);
      color: var(--text);
    }
    a { color: var(--link); text-decoration: none; }

    /* =========================
       Header
       ========================= */
    .site-header {
      position: sticky; top: 0; z-index: 100;
      display: grid;
      grid-template-columns: auto auto 1fr auto; /* menu, company logo, title, partner logo */
      align-items: center; gap: .75rem;
      padding: .6rem .9rem;
      background: color-mix(in oklab, var(--panel) 70%, transparent);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--border);
    }

    .menu-btn {
      display: inline-flex; align-items: center; justify-content: center;
      width: 38px; height: 38px;
      border: 1px solid var(--border);
      background: var(--panel); color: var(--text);
      border-radius: 10px; box-shadow: var(--shadow);
      cursor: pointer;
    }
    .menu-btn:hover { background: color-mix(in oklab, var(--panel) 88%, white 12%); }
    .menu-btn svg { width: 20px; height: 20px; }

    .site-header .logo { display: flex; align-items: center; height: 40px; }
    .site-header .logo img {
      max-height: 100%; max-width: 180px; object-fit: contain;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.25));
    }

    .site-header .site-title {
      text-align: center;
      font-style: italic; /* requested italic */
      font-weight: 700;
      letter-spacing: 0.25px;
      font-size: clamp(1rem, 2.5vw, 1.25rem);
      color: var(--text);
    }

    /* =========================
       Main layout (Content + TOC)
       ========================= */
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1fr) 320px; /* content + TOC */
      gap: 1rem; padding: 1rem; max-width: 1700px; margin: 0 auto;
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    .panel-header {
      padding: .6rem .8rem;
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
      background: color-mix(in oklab, var(--panel) 96%, white 4%);
    }
    .panel-header h2 { margin: 0; font-size: .95rem; font-weight: 600; color: var(--text); }

    .collapse-btn {
      display: inline-flex; align-items: center; gap: .35rem;
      font-size: .85rem; color: var(--muted);
      border: 1px solid var(--border);
      background: transparent;
      padding: .25rem .5rem; border-radius: 8px; cursor: pointer;
    }
    .collapse-btn:hover { background: transparent; color: var(--muted); } /* no highlight on hover */
    .panel.collapsed .panel-body { display: none; }
    .panel.collapsed { min-height: 48px; }

    .content .panel-body {
      overflow-y: auto; max-height: calc(100vh - 170px);
      padding: 1rem 1.25rem;
    }
    .markdown-body { line-height: 1.6; }
    .markdown-body h1, .markdown-body h2, .markdown-body h3,
    .markdown-body h4, .markdown-body h5, .markdown-body h6 {
      margin: 1.2rem 0 .6rem;
      scroll-margin-top: 80px;
    }
    .markdown-body h1 { font-size: 1.9rem; }
    .markdown-body h2 { font-size: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: .25rem; }
    .markdown-body h3 { font-size: 1.2rem; color: color-mix(in oklab, var(--text) 80%, var(--muted) 20%); }
    .markdown-body p { margin: .7rem 0; color: var(--text); }
    .markdown-body code { background: color-mix(in oklab, var(--panel) 85%, white 15%); padding: 0 .25rem; border-radius: 4px; }
    .markdown-body pre {
      background: color-mix(in oklab, var(--panel) 85%, white 15%);
      border: 1px solid var(--border); border-radius: 10px; padding: .9rem; overflow: auto;
    }
    .markdown-body table { width: 100%; border-collapse: collapse; margin: .8rem 0; font-size: .95rem; }
    .markdown-body th, .markdown-body td { border: 1px solid var(--border); padding: .5rem .6rem; }
    .markdown-body img { max-width: 100%; height: auto; border-radius: 8px; }

    .toc .panel-body { overflow-y: auto; max-height: calc(100vh - 170px); }
    .toc nav { padding: .25rem .5rem; }

    /* =========================
       TOC: Pronounced brand hover
       ========================= */
    .toc a {
      display: block;
      padding: .35rem .5rem;
      border-radius: 8px;
      color: var(--muted);
      transition:
        background-color .15s ease,
        color .15s ease,
        box-shadow .15s ease,
        text-decoration-color .15s ease;
    }
    .toc a:hover {
      background: color-mix(in oklab, var(--brand) 16%, var(--panel) 84%);
      color: var(--text);
      text-decoration: none;
      box-shadow: 0 0 0 2px color-mix(in oklab, var(--brand) 30%, transparent);
    }
    .toc a:focus {
      outline: none;
      box-shadow: 0 0 0 2px color-mix(in oklab, var(--brand) 45%, transparent);
      background: color-mix(in oklab, var(--brand) 12%, var(--panel) 88%);
      color: var(--text);
    }
    .toc .level-1 { margin-left: 0; font-weight: 700; color: var(--text); }
    .toc .level-2 { margin-left: .5rem; }
    .toc .level-3 { margin-left: 1rem; }
    .toc .level-4 { margin-left: 1.5rem; font-size: .95rem; }
    .toc .level-5, .toc .level-6 { margin-left: 2rem; font-size: .9rem; }

    /* =========================
       Main content: disable hover highlight
       ========================= */
    .content .panel-body .markdown-body *:hover {
      background: transparent !important;
      color: inherit;
      text-decoration-color: inherit;
    }
    .markdown-body a {
      color: var(--link);
      text-decoration: underline;
    }
    .markdown-body a:hover {
      text-decoration: underline;
      background: transparent;
      color: var(--link);
    }

    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; }
      .toc { grid-column: 1 / -1; }
      .toc .panel-body { max-height: none; }
    }

    /* =========================
       Left Swipe Drawer (25% width)
       ========================= */
    .menu-overlay {
      position: fixed; inset: 0;
      background: color-mix(in oklab, var(--bg) 40%, black 10%); /* subtle backdrop */
      display: none; z-index: 300;
    }
    .menu-overlay.open { display: block; }

    .menu-drawer {
      position: absolute; left: 0; top: 0; bottom: 0;
      width: clamp(280px, 25vw, 420px); /* ≈25% screen */
      background: var(--panel);
      border-right: 1px solid var(--border);
      box-shadow: var(--shadow);
      transform: translateX(-100%);
      transition: transform .25s ease;
      display: grid; grid-template-rows: auto 1fr auto; /* header, body, footer */
    }
    .menu-overlay.open .menu-drawer { transform: translateX(0); }

    .menu-drawer-header {
      display: flex; align-items: center; gap: .5rem;
      padding: .6rem .9rem; border-bottom: 1px solid var(--border);
    }
    .menu-drawer-header .brand {
      display: flex; align-items: center; height: 36px;
    }
    .menu-drawer-header .brand img {
      max-height: 100%; max-width: 160px; object-fit: contain;
    }
    .menu-title { margin-left: auto; font-weight: 600; font-size: .95rem; color: var(--muted); }

    .menu-drawer-body {
      padding: .6rem .9rem; overflow: auto;
    }
    .index-list { list-style: none; margin: 0; padding: 0; }
    .index-item {
      display: grid; grid-template-columns: 1fr auto; align-items: center;
      gap: .5rem; padding: .6rem .75rem; border: 1px solid var(--border);
      border-radius: 10px; margin-bottom: .6rem; cursor: pointer;
      background: transparent;
    }
    .index-item:hover { background: transparent; } /* keep neutral on hover */
    .index-item .badge {
      font-size: .75rem; color: var(--muted);
      border: 1px solid var(--border); padding: .15rem .4rem; border-radius: 999px;
    }

    .menu-drawer-footer {
      padding: .6rem .9rem; border-top: 1px solid var(--border);
    }
    .settings-row {
      display: flex; align-items: center; justify-content: space-between;
      gap: .75rem; padding: .25rem 0;
    }
    .switch {
      position: relative; width: 52px; height: 28px;
      background: color-mix(in oklab, var(--panel) 85%, white 15%);
      border: 1px solid var(--border); border-radius: 999px; cursor: pointer;
    }
    .switch .thumb {
      position: absolute; top: 2px; left: 2px;
      width: 24px; height: 24px; border-radius: 50%;
      background: var(--text); transition: left .2s ease;
    }
    .switch[data-checked="true"] .thumb { left: 26px; }
  </style>
</head>
<body>

  <!-- ===================== HEADER ===================== -->
  <header class="site-header" aria-label="Site header">
    <!-- Menu button (opens 25% left drawer) -->
    <button class="menu-btn" id="open-menu" title="Open Menu" aria-haspopup="true" aria-controls="menu-overlay">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
        <path d="M4 6h16M4 12h16M4 18h16" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </button>

    <div class="logo company" aria-label="Company logo">
      <!-- ✅ Company logo file (in the same folder) -->
      <img src="Company logo.png" alt="Company logo" />
    </div>

    <div class="site-title" aria-label="Company name">
      <!-- TODO: Replace with your company/product name -->
      Nimbus Cloud – User Manuals
    </div>

    <div class="logo partner" aria-label="Partner logo">
      <!-- TODO: Replace with your partner logo path or URL -->
      <img src="images/partner-logo.png" alt="Partner logo" />
    </div>
  </header>

  <!-- ===================== MAIN LAYOUT ===================== -->
  <main class="layout" aria-label="Main content" id="layout">
    <!-- MIDDLE: Markdown viewer -->
    <section class="panel content" aria-label="Markdown viewer">
      <div class="panel-header">
        <h2 id="current-manual-title">No manual loaded</h2>
        <span id="load-status" style="color:var(--muted); font-size:.85rem;"></span>
      </div>
      <div class="panel-body">
        <article id="markdown-view" class="markdown-body" aria-live="polite">
          <div class="placeholder">
            <h3>Welcome</h3>
            <p>Click <strong>Menu</strong> (top-left) → pick a manual in <em>Index</em>. This area renders your Markdown.</p>
            <p style="color:var(--muted)">
              <!--
                TODO: Add more manuals in MANUALS_DATA below.
                Each item needs: id, name, lang (e.g., 'Markdown'), url (RAW link).
              -->
              Tip: In GitHub, open your .md → click <strong>Raw</strong> → copy the URL.
            </p>
          </div>
        </article>
      </div>
    </section>

    <!-- RIGHT: Table of contents (Collapsible) -->
    <aside class="panel toc" aria-label="Table of contents" id="panel-right">
      <div class="panel-header">
        <h2>Table of Contents</h2>
        <button class="collapse-btn" id="btn-collapse-right" aria-expanded="true" aria-controls="panel-right-body" title="Collapse TOC">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <path d="M6 9l6 6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Collapse
        </button>
      </div>
      <div class="panel-body" id="panel-right-body">
        <nav id="toc" aria-label="Headings in document"></nav>
      </div>
    </aside>
  </main>

  <!-- ===================== LEFT SWIPE DRAWER (25%) ===================== -->
  <div class="menu-overlay" id="menu-overlay" role="dialog" aria-modal="true" aria-label="Menu">
    <div class="menu-drawer" id="menu-drawer">
      <!-- Drawer header: company logo top-left -->
      <div class="menu-drawer-header">
        <div class="brand">
          <img src="Company logo.png" alt="Company logo" />
        </div>
        <div class="menu-title">Index</div>
      </div>

      <!-- Drawer body: list of manuals with language badge -->
      <div class="menu-drawer-body">
        <ul id="drawer-index-list" class="index-list" aria-live="polite">
          <!-- Items injected from MANUALS_DATA -->
        </ul>
      </div>

      <!-- Drawer footer: Theme switch at bottom -->
      <div class="menu-drawer-footer">
        <div class="settings-row">
          <span>Theme</span>
          <div class="switch" id="theme-switch" role="switch" aria-checked="false" tabindex="0" data-checked="false" title="Toggle Light/Dark">
            <div class="thumb" aria-hidden="true"></div>
          </div>
        </div>
        <p style="color:var(--muted); font-size:.85rem; margin:.25rem 0 0;">
          Remembers your choice via <code>localStorage</code>.
        </p>
      </div>
    </div>
  </div>

  <!-- ===================== DEPENDENCIES (correct script tags) ===================== -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

  <!-- ===================== PAGE LOGIC ===================== -->
  <script>
    // ===========================================================
    // Manuals list (add more items as needed)
    // - id: unique key
    // - name: display name
    // - lang: language label (e.g., "Markdown")
    // - url: RAW GitHub URL to the .md file
    // ===========================================================
    const MANUALS_DATA = [
      {
        id: "pmv-scheme",
        name: "PMV Scheme",
        lang: "Markdown",
        url: "https://raw.githubusercontent.com/Surya-Jaganathan/PSB-PMV-scheme-user-manual/refs/heads/main/README.md"
      }
      // ,{ id: "another-manual", name: "Another Manual", lang: "Markdown", url: "https://raw.githubusercontent.com/..." }
    ];

    let CURRENT_MANUAL = null;

    // Build Index (drawer)
    function buildDrawerIndex() {
      const listEl = document.getElementById("drawer-index-list");
      listEl.innerHTML = "";
      MANUALS_DATA.forEach(m => {
        const li = document.createElement("li");
        li.className = "index-item";
        li.setAttribute("data-id", m.id);

        const name = document.createElement("span");
        name.textContent = m.name;

        const badge = document.createElement("span");
        badge.className = "badge";
        badge.textContent = m.lang || "Markdown";

        li.appendChild(name);
        li.appendChild(badge);
        li.addEventListener("click", () => {
          loadManualById(m.id);
          closeMenu();
        });
        listEl.appendChild(li);
      });
    }

    // Utility: normalize RAW URLs (fallback if GitHub returns 404 on refs/heads)
    function normalizeRawUrl(url) {
      try {
        // If URL contains '/refs/heads/', GitHub RAW also supports '/main/' style
        return url.replace("/refs/heads/", "/");
      } catch {
        return url;
      }
    }

    // Slugify headings
    function slugify(text) {
      return text.toLowerCase().trim()
        .replace(/[^\w\s-]/g, "")
        .replace(/\s+/g, "-");
    }

    // Render Markdown + fix relative images
    async function renderMarkdown(mdText) {
      const html = marked.parse(mdText, { gfm: true, breaks: false });
      const safeHtml = DOMPurify.sanitize(html, { ADD_ATTR: ["target"] });

      const container = document.getElementById("markdown-view");
      container.innerHTML = safeHtml;

      // Resolve relative image paths using the md file's RAW URL as base
      if (CURRENT_MANUAL?.url) {
        const baseUrl = CURRENT_MANUAL.url;
        const imgs = container.querySelectorAll("img");
        imgs.forEach(img => {
          const src = img.getAttribute("src");
          if (!src) return;
          try {
            const resolved = new URL(src, baseUrl).href;
            img.src = resolved;
          } catch { /* ignore malformed URLs */ }
          img.loading = "lazy";
          img.decoding = "async";
        });
      }

      assignHeadingIdsAndBuildTOC(container);
    }

    // Assign IDs and build TOC
    function assignHeadingIdsAndBuildTOC(container) {
      const headings = container.querySelectorAll("h1, h2, h3, h4, h5, h6");
      const used = new Set();
      headings.forEach(h => {
        let base = slugify(h.textContent);
        let id = base || h.tagName.toLowerCase();
        let i = 2;
        while (used.has(id) || document.getElementById(id)) {
          id = `${base}-${i++}`;
        }
        used.add(id);
        h.id = id;
      });
      buildTOC(headings);
    }

    function buildTOC(headings) {
      const toc = document.getElementById("toc");
      toc.innerHTML = "";
      headings.forEach(h => {
        const level = parseInt(h.tagName.substring(1), 10);
        const a = document.createElement("a");
        a.href = `#${h.id}`;
        a.textContent = h.textContent;
        a.className = `level-${level}`;
        toc.appendChild(a);
      });
      // Smooth scroll
      toc.querySelectorAll("a").forEach(a => {
        a.addEventListener("click", (ev) => {
          ev.preventDefault();
          const targetId = a.getAttribute("href").slice(1);
          const el = document.getElementById(targetId);
          if (!el) return;
          el.scrollIntoView({ behavior: "smooth", block: "start" });
          history.replaceState(null, "", `#${targetId}`);
        });
      });
    }

    // Load manual
    async function loadManualById(id) {
      const manual = MANUALS_DATA.find(m => m.id === id);
      const statusEl = document.getElementById("load-status");
      const titleEl = document.getElementById("current-manual-title");

      if (!manual) {
        titleEl.textContent = "Manual not found";
        statusEl.textContent = "";
        document.getElementById("markdown-view").innerHTML =
          `<div class="placeholder"><p style="color:var(--danger)">Error: Manual ID "${id}" not found.</p></div>`;
        return;
      }

      CURRENT_MANUAL = manual;
      titleEl.textContent = manual.name;
      statusEl.textContent = "Loading…";

      // Try original URL, fallback to normalized URL if it fails
      let rawUrl = manual.url;
      try {
        let res = await fetch(rawUrl, { cache: "no-store" });
        if (!res.ok) {
          // Retry with normalized URL
          const fallback = normalizeRawUrl(rawUrl);
          if (fallback !== rawUrl) {
            res = await fetch(fallback, { cache: "no-store" });
            rawUrl = fallback;
          }
        }
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const mdText = await res.text();
        // Update manual URL to the working one for image resolution
        CURRENT_MANUAL.url = rawUrl;
        await renderMarkdown(mdText);
        statusEl.textContent = "Loaded ✓";
      } catch (err) {
        console.error(err);
        statusEl.textContent = "";
        document.getElementById("markdown-view").innerHTML =
          `<div class="placeholder">
             <p style="color:var(--danger)">Failed to load Markdown.</p>
             <p><strong>Tried URL(s):</strong></p>
             <pre>${manual.url}\n${normalizeRawUrl(manual.url)}</pre>
             <p style="color:var(--muted)">If the repo is private, browsers can’t fetch RAW without auth (CORS). Use a public repo or proxy.</p>
           </div>`;
      }
    }

    // TOC collapse (button remains visible)
    const panelRight = document.getElementById("panel-right");
    const btnRight = document.getElementById("btn-collapse-right");
    function toggleRightCollapse() {
      const isCollapsed = panelRight.classList.toggle("collapsed");
      btnRight.setAttribute("aria-expanded", String(!isCollapsed));
      btnRight.title = isCollapsed ? "Expand TOC" : "Collapse TOC";
    }
    btnRight.addEventListener("click", toggleRightCollapse);

    // Drawer open/close
    const overlay = document.getElementById("menu-overlay");
    const openBtn = document.getElementById("open-menu");
    const drawer = document.getElementById("menu-drawer");
    function openMenu(e) {
      if (e) e.stopPropagation();
      overlay.classList.add("open");
    }
    function closeMenu() {
      overlay.classList.remove("open");
    }
    openBtn.addEventListener("click", openMenu);
    // Close when clicking outside the drawer
    overlay.addEventListener("click", (e) => {
      if (!drawer.contains(e.target)) closeMenu();
    });
    // ESC to close
    document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeMenu(); });

    // Theme switch
    const themeSwitch = document.getElementById("theme-switch");
    function applyTheme(theme) {
      document.documentElement.setAttribute("data-theme", theme);
      const checked = theme === "dark";
      themeSwitch.dataset.checked = String(checked);
      themeSwitch.setAttribute("aria-checked", String(checked));
      localStorage.setItem("theme", theme);
    }
    function initTheme() {
      const saved = localStorage.getItem("theme");
      if (saved === "light" || saved === "dark") applyTheme(saved);
      else applyTheme(window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light");
    }
    function toggleTheme() {
      const current = document.documentElement.getAttribute("data-theme") || "light";
      applyTheme(current === "light" ? "dark" : "light");
    }
    themeSwitch.addEventListener("click", toggleTheme);
    themeSwitch.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); toggleTheme(); }
    });

    // Init
    function init() {
      initTheme();
      buildDrawerIndex();
      if (MANUALS_DATA[0]) loadManualById(MANUALS_DATA[0].id);
    }
    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</

