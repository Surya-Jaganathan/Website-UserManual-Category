
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>User Manuals Portal</title>

  <!--
    ===========================================================
    âœ¨ PAGE OVERVIEW
    - Header: Company logo (left), Company name (center), Partner logo (right)
    - Left panel: Collapsible Index (manual categories)
    - Middle panel: Selected manual rendered from Markdown (GitHub RAW URLs)
    - Right panel: Collapsible Table of Contents, auto-built from headings
    - Floating right-side Settings menu: Light/Dark theme switch (persistent)
    ===========================================================
    ðŸ”§ Where to paste your Markdown links:
      Scroll down to: const MANUALS_DATA = [ ... ]
      Fill each item's: id, name, url (RAW GitHub link to .md)
    ===========================================================
  -->

  <style>
    /* =========================
       THEME SYSTEM (Light/Dark)
       ========================= */
    :root {
      color-scheme: light dark; /* allow UA to pick form controls correctly */
    }
    :root[data-theme="dark"] {
      --bg: #0f172a;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --brand: #4f46e5;
      --border: #1f2937;
      --link: #60a5fa;
      --success: #10b981;
      --danger: #ef4444;
      --shadow: 0 8px 24px rgba(0,0,0,0.35);
    }
    :root[data-theme="light"] {
      --bg: #f5f7fb;
      --panel: #ffffff;
      --text: #1f2937;
      --muted: #6b7280;
      --brand: #4f46e5;
      --border: #e5e7eb;
      --link: #1d4ed8;
      --success: #0f766e;
      --danger: #dc2626;
      --shadow: 0 8px 24px rgba(0,0,0,0.08);
    }

    /* =========================
       Reset + Base
       ========================= */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    html { scroll-behavior: smooth; } /* nice anchor scrolling */
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background:
        radial-gradient(1200px 600px at 10% 10%, rgba(11,19,36,0.15), transparent),
        var(--bg);
      color: var(--text);
    }
    a { color: var(--link); text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* =========================
       Header
       ========================= */
    .site-header {
      position: sticky;
      top: 0;
      z-index: 100;
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      gap: 1rem;
      padding: .75rem 1rem;
      background: color-mix(in oklab, var(--panel) 70%, transparent);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--border);
    }
    .site-header .logo {
      display: flex;
      align-items: center;
      height: 40px;
    }
    .site-header .logo img {
      max-height: 100%;
      max-width: 180px;
      object-fit: contain;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.25));
    }
    .site-header .site-title {
      text-align: center;
      font-weight: 700;
      letter-spacing: 0.25px;
      font-size: clamp(1rem, 2.5vw, 1.25rem);
      color: var(--text);
    }
    .site-header .logo.partner { justify-content: flex-end; }

    /* =========================
       Layout grid
       ========================= */
    .layout {
      display: grid;
      grid-template-columns: 280px minmax(0, 1fr) 320px;
      gap: 1rem;
      padding: 1rem;
      max-width: 1700px;
      margin: 0 auto;
      transition: grid-template-columns .25s ease;
    }
    /* When panels are collapsed, adjust column widths */
    .layout.collapse-left { grid-template-columns: 0px minmax(0, 1fr) 320px; }
    .layout.collapse-right { grid-template-columns: 280px minmax(0, 1fr) 0px; }
    .layout.collapse-both { grid-template-columns: 0px minmax(0, 1fr) 0px; }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: var(--shadow);
    }
    .panel-header {
      padding: .6rem .8rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: color-mix(in oklab, var(--panel) 96%, white 4%);
    }
    .panel-header h2 { margin: 0; font-size: .95rem; font-weight: 600; color: var(--text); }

    /* Collapse button */
    .collapse-btn {
      display: inline-flex;
      align-items: center;
      gap: .35rem;
      font-size: .85rem;
      color: var(--muted);
      border: 1px solid var(--border);
      background: transparent;
      padding: .25rem .5rem;
      border-radius: 8px;
      cursor: pointer;
    }
    .collapse-btn:hover { color: var(--text); background: color-mix(in oklab, var(--panel) 88%, white 12%); }
    .collapse-btn svg { width: 16px; height: 16px; }

    /* Hide panel body when collapsed */
    .panel.collapsed .panel-body { display: none; }
    .panel.collapsed { min-height: 48px; }

    /* Left: Categories */
    .categories { display: flex; flex-direction: column; }
    .categories .panel-body { overflow-y: auto; max-height: calc(100vh - 170px); }
    .category-list { list-style: none; margin: 0; padding: 0; }
    .category-item {
      display: grid;
      grid-template-columns: 1fr auto;
      gap: .5rem;
      align-items: center;
      padding: .6rem .9rem;
      border-bottom: 1px dashed var(--border);
      cursor: pointer;
      color: var(--text);
    }
    .category-item:hover { background: color-mix(in oklab, var(--panel) 90%, white 10%); }
    .category-item.active { background: color-mix(in oklab, var(--brand) 22%, var(--panel) 78%); border-left: 3px solid var(--brand); }
    .category-item .name { font-weight: 600; }
    .category-item .badge {
      font-size: .75rem;
      color: var(--muted);
      border: 1px solid var(--border);
      padding: .15rem .4rem;
      border-radius: 999px;
    }

    /* Middle: Markdown viewer */
    .content { position: relative; }
    .content .panel-body {
      overflow-y: auto; max-height: calc(100vh - 170px);
      padding: 1rem 1.25rem;
    }
    .markdown-body { line-height: 1.6; }
    .markdown-body h1, .markdown-body h2, .markdown-body h3,
    .markdown-body h4, .markdown-body h5, .markdown-body h6 {
      margin: 1.2rem 0 .6rem;
      scroll-margin-top: 80px; /* sticky header offset for anchor targets */
    }
    .markdown-body h1 { font-size: 1.9rem; }
    .markdown-body h2 { font-size: 1.5rem; border-bottom: 1px solid var(--border); padding-bottom: .25rem; }
    .markdown-body h3 { font-size: 1.2rem; color: color-mix(in oklab, var(--text) 80%, var(--muted) 20%); }
    .markdown-body p { margin: .7rem 0; color: var(--text); }
    .markdown-body code { background: color-mix(in oklab, var(--panel) 85%, white 15%); padding: 0 .25rem; border-radius: 4px; }
    .markdown-body pre {
      background: color-mix(in oklab, var(--panel) 85%, white 15%);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: .9rem;
      overflow: auto;
    }
    .markdown-body table { width: 100%; border-collapse: collapse; margin: .8rem 0; font-size: .95rem; }
    .markdown-body th, .markdown-body td { border: 1px solid var(--border); padding: .5rem .6rem; }
    .placeholder {
      border: 1px dashed var(--border);
      padding: 1rem; border-radius: 12px; background: color-mix(in oklab, var(--panel) 92%, white 8%);
    }

    /* Right: TOC */
    .toc .panel-body { overflow-y: auto; max-height: calc(100vh - 170px); }
    .toc nav { padding: .25rem .5rem; }
    .toc a {
      display: block; padding: .35rem .5rem; border-radius: 8px; color: var(--muted);
    }
    .toc a:hover { background: color-mix(in oklab, var(--panel) 90%, white 10%); color: var(--text); }
    .toc .level-1 { margin-left: 0; font-weight: 700; color: var(--text); }
    .toc .level-2 { margin-left: .5rem; }
    .toc .level-3 { margin-left: 1rem; }
    .toc .level-4 { margin-left: 1.5rem; font-size: .95rem; }
    .toc .level-5, .toc .level-6 { margin-left: 2rem; font-size: .9rem; }

    /* Responsive adjustments */
    @media (max-width: 1100px) {
      .layout { grid-template-columns: 240px 1fr; }
      .toc { grid-column: 1 / -1; }
      .toc .panel-body { max-height: none; }
    }
    @media (max-width: 750px) {
      .site-header { grid-template-columns: 1fr; text-align: center; }
      .site-header .logo.company, .site-header .logo.partner { justify-content: center; }
      .layout { grid-template-columns: 1fr; }
      .categories .panel-body, .content .panel-body { max-height: none; }
      .toc nav a { padding: .25rem .4rem; }
    }

    /* =========================
       Floating Settings menu
       ========================= */
    .settings-container {
      position: fixed;
      right: 18px;
      bottom: 18px;
      z-index: 200;
    }
    .settings-fab {
      border: 1px solid var(--border);
      background: var(--panel);
      color: var(--text);
      width: 46px; height: 46px;
      border-radius: 50%;
      display: grid; place-items: center;
      box-shadow: var(--shadow);
      cursor: pointer;
    }
    .settings-fab:hover { background: color-mix(in oklab, var(--panel) 88%, white 12%); }
    .settings-drawer {
      position: absolute;
      right: 0;
      bottom: 56px;
      width: 260px;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: .75rem;
      display: none;
    }
    .settings-drawer.open { display: block; }
    .settings-row {
      display: flex; align-items: center; justify-content: space-between;
      gap: .75rem; padding: .4rem .25rem;
    }
    .switch {
      position: relative; width: 48px; height: 26px;
      background: color-mix(in oklab, var(--panel) 85%, white 15%);
      border: 1px solid var(--border); border-radius: 999px;
      cursor: pointer;
    }
    .switch .thumb {
      position: absolute; top: 2px; left: 2px;
      width: 22px; height: 22px; border-radius: 50%;
      background: var(--text);
      transition: left .2s ease;
    }
    .switch[data-checked="true"] .thumb { left: 24px; }

    .settings-divider {
      border-top: 1px dashed var(--border);
      margin: .5rem 0;
    }
    .settings-title {
      font-size: .9rem; font-weight: 600;
    }

  </style>
</head>
<body>

  <!-- ===================== HEADER ===================== -->
  <header class="site-header" aria-label="Site header">
    <div class="logo company" aria-label="Company logo">
      <!--
        TODO: Replace with your company logo (local path or URL):
        Example: <img src="images/company-logo.png" alt="Company logo">
      -->
      <img src="Company logo.png" alt="SysArc Infomatix">
    </div>

    <div class="site-title" aria-label="Company name">
      <!--
        TODO: Replace with your company/product name
      -->
      lendPerfect â€“ User Manuals
    </div>

    <div class="logo partner" aria-label="Partner logo">
      <!--
        TODO: Replace with your partner logo path or URL.
      -->
      <img src="images/partner-logo.png" alt="Partner logo">
    </div>
  </header>

  <!-- ===================== MAIN LAYOUT ===================== -->
  <main class="layout" aria-label="Main content" id="layout">
    <!-- LEFT: Categories (Collapsible) -->
    <aside class="panel categories" aria-label="User manual categories" id="panel-left">
      <div class="panel-header">
        <h2>Index</h2>
        <button class="collapse-btn" id="btn-collapse-left" aria-expanded="true" aria-controls="panel-left-body" title="Collapse Index">
          <!-- Chevron icon -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <path d="M6 9l6 6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Collapse
        </button>
      </div>
      <div class="panel-body" id="panel-left-body">
        <ul id="manual-list" class="category-list" aria-live="polite">
          <!-- Items injected from MANUALS_DATA -->
        </ul>
      </div>
    </aside>

    <!-- MIDDLE: Markdown viewer -->
    <section class="panel content" aria-label="Markdown viewer">
      <div class="panel-header">
        <h2 id="current-manual-title">No manual loaded</h2>
        <span id="load-status" style="color:var(--muted); font-size:.85rem;"></span>
      </div>
      <div class="panel-body">
        <article id="markdown-view" class="markdown-body" aria-live="polite">
          <div class="placeholder">
            <h3>Welcome</h3>
            <p>Select a manual from the Index. This area will render the Markdown content.</p>
            <p style="color:var(--muted)">
              <!--
                TODO: IMPORTANT â€” Paste your GitHub Markdown links in the JS section below.
                Find: const MANUALS_DATA = [ ... ]
                Each item needs: id, name, url (RAW GitHub Markdown link)
                Example RAW URL:
                  https://raw.githubusercontent.com/your-org/your-repo/main/docs/getting-started.md
              -->
              Tip: In GitHub, open your .md file â†’ click <strong>Raw</strong> â†’ copy that URL.
            </p>
          </div>
        </article>
      </div>
    </section>

    <!-- RIGHT: Table of contents (Collapsible) -->
    <aside class="panel toc" aria-label="Table of contents" id="panel-right">
      <div class="panel-header">
        <h2>Table of Contents</h2>
        <button class="collapse-btn" id="btn-collapse-right" aria-expanded="true" aria-controls="panel-right-body" title="Collapse TOC">
          <!-- Chevron icon -->
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" aria-hidden="true">
            <path d="M6 9l6 6 6-6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Collapse
        </button>
      </div>
      <div class="panel-body" id="panel-right-body">
        <nav id="toc" aria-label="Headings in document">
          <!-- Built after Markdown renders -->
        </nav>
      </div>
    </aside>
  </main>

  <!-- ===================== FLOATING SETTINGS MENU ===================== -->
  <div class="settings-container" aria-label="Settings">
    <button class="settings-fab" id="settings-fab" aria-haspopup="true" aria-controls="settings-drawer" title="Open Settings">
      <!-- Gear icon -->
      <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" aria-hidden="true">
        <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" stroke-width="2"/>
        <path d="M19.4 15a7.8 7.8 0 0 0 .1-6l2-3.4-3.1-3.1-3.4 2a7.8 7.8 0 0 0-6 .1l-3.4-2L1.1 5.6l2 3.4a7.8 7.8 0 0 0-.1 6l-2 3.4 3.1 3.1 3.4-2a7.8 7.8 0 0 0 6-.1l3.4 2 3.1-3.1-2-3.4Z" stroke-width="1.5" opacity=".6"/>
      </svg>
    </button>

    <div class="settings-drawer" id="settings-drawer" role="dialog" aria-modal="false">
      <div class="settings-title">Appearance</div>
      <div class="settings-row">
        <span>Theme</span>
        <!-- Accessible custom switch; syncs to localStorage -->
        <div class="switch" id="theme-switch" role="switch" aria-checked="false" tabindex="0" data-checked="false" title="Toggle Light/Dark">
          <div class="thumb" aria-hidden="true"></div>
        </div>
      </div>
      <div class="settings-divider"></div>
      <div class="settings-row" style="font-size:.85rem;color:var(--muted);">
        <span>Uses <code>localStorage</code> to remember your choice</span>
      </div>
    </div>
  </div>

  <!-- ===================== DEPENDENCIES ===================== -->
  <!-- Marked.js: Markdown parser -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- DOMPurify: Sanitize HTML generated from Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>

  <!-- ===================== PAGE LOGIC ===================== -->
  <script>
    // ===========================================================
    // TODO: PASTE YOUR MANUALS HERE
    // - id: a URL-safe unique key (used in #hash and selection)
    // - name: what appears in the Index list and header
    // - url: the RAW GitHub URL to the .md file
    // ===========================================================
    const MANUALS_DATA = [
      {
        id: "getting-started",
        name: "Getting Started",
        // TODO: Replace with your GitHub RAW Markdown URL:
        url: "https://raw.githubusercontent.com/Surya-Jaganathan/PSB-PMV-scheme-user-manual/refs/heads/main/README.md"
      },
      {
        id: "admin-guide",
        name: "Admin Guide",
        // TODO: Replace with your GitHub RAW Markdown URL:
        url: "https://raw.githubusercontent.com/your-org/your-repo/main/docs/admin-guide.md"
      },
      {
        id: "end-user",
        name: "End-User Manual",
        // TODO: Replace with your GitHub RAW Markdown URL:
        url: "https://raw.githubusercontent.com/your-org/your-repo/main/docs/end-user-manual.md"
      }
    ];

    // ===========================================================
    // Utility: Slugify heading text for stable anchor IDs
    // ===========================================================
    function slugify(text) {
      return text.toLowerCase().trim()
        .replace(/[^\w\s-]/g, "")
        .replace(/\s+/g, "-");
    }

    // ===========================================================
    // Build the Index (left list)
    // ===========================================================
    function buildManualList() {
      const listEl = document.getElementById("manual-list");
      listEl.innerHTML = "";
      MANUALS_DATA.forEach(m => {
        const li = document.createElement("li");
        li.className = "category-item";
        li.setAttribute("data-id", m.id);

        const name = document.createElement("span");
        name.className = "name";
        name.textContent = m.name;

        const badge = document.createElement("span");
        badge.className = "badge";
        badge.textContent = "Markdown";

        li.appendChild(name);
        li.appendChild(badge);
        li.addEventListener("click", () => loadManualById(m.id));
        listEl.appendChild(li);
      });
    }

    // ===========================================================
    // Render Markdown into the middle panel
    // ===========================================================
    async function renderMarkdown(mdText) {
      marked.use({ gfm: true, breaks: false });
      const html = marked.parse(mdText);
      const safeHtml = DOMPurify.sanitize(html, { ADD_ATTR: ["target"] });

      const container = document.getElementById("markdown-view");
      container.innerHTML = safeHtml;

      // After rendering, assign IDs to headings and build TOC
      assignHeadingIdsAndBuildTOC(container);
    }

    // ===========================================================
    // Assign IDs to headings, then build the TOC
    // ===========================================================
    function assignHeadingIdsAndBuildTOC(container) {
      const headings = container.querySelectorAll("h1, h2, h3, h4, h5, h6");
      const used = new Set();

      headings.forEach(h => {
        let base = slugify(h.textContent);
        let id = base || h.tagName.toLowerCase();
        let i = 2;
        while (used.has(id) || document.getElementById(id)) {
          id = `${base}-${i++}`;
        }
        used.add(id);
        h.id = id;
      });

      buildTOC(headings);
    }

    function buildTOC(headings) {
      const toc = document.getElementById("toc");
      toc.innerHTML = "";

      headings.forEach(h => {
        const level = parseInt(h.tagName.substring(1), 10);
        const a = document.createElement("a");
        a.href = `#${h.id}`;
        a.textContent = h.textContent;
        a.className = `level-${level}`;
        toc.appendChild(a);
      });

      // Ensure smooth scroll with sticky header offset
      // (scroll-margin-top on headings already helps, but we add guard)
      toc.querySelectorAll("a").forEach(a => {
        a.addEventListener("click", (ev) => {
          // Allow default hash update for shareability
          ev.preventDefault();
          const targetId = a.getAttribute("href").slice(1);
          const el = document.getElementById(targetId);
          if (!el) return;
          // Smooth scroll, then update hash
          el.scrollIntoView({ behavior: "smooth", block: "start" });
          history.replaceState(null, "", `#${targetId}`);
        });
      });
    }

    // ===========================================================
    // Load a manual by its `id` from MANUALS_DATA
    // ===========================================================
    async function loadManualById(id) {
      const manual = MANUALS_DATA.find(m => m.id === id);
      const statusEl = document.getElementById("load-status");
      const titleEl = document.getElementById("current-manual-title");

      // Update selection highlight
      document.querySelectorAll(".category-item").forEach(el => {
        el.classList.toggle("active", el.getAttribute("data-id") === id);
      });

      if (!manual) {
        titleEl.textContent = "Manual not found";
        statusEl.textContent = "";
        document.getElementById("markdown-view").innerHTML =
          `<div class="placeholder">
             <p style="color:var(--danger)">Error: Manual ID "${id}" not found in MANUALS_DATA.</p>
           </div>`;
        return;
      }

      titleEl.textContent = manual.name;
      statusEl.textContent = "Loadingâ€¦";

      try {
        // NOTE: Use RAW GitHub URLs (raw.githubusercontent.com) for CORS-friendly fetch
        const res = await fetch(manual.url, { cache: "no-store" });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const mdText = await res.text();
        await renderMarkdown(mdText);
        statusEl.textContent = "Loaded âœ“";
        // Update only the manual hash (not headings)
        location.hash = manual.id;
        // Ensure TOC visible if previously collapsed on mobile
        // (optional behavior, leave as-is if you don't want auto expand)
      } catch (err) {
        statusEl.textContent = "";
        document.getElementById("markdown-view").innerHTML =
          `<div class="placeholder">
             <p style="color:var(--danger)">Failed to load Markdown.</p>
             <p><strong>Check the URL in MANUALS_DATA:</strong></p>
             <pre>${manual.url}</pre>
             <p style="color:var(--muted)">If the repository is private, the browser cannot fetch it without auth. Use a public repo or serve the files locally.</p>
           </div>`;
      }
    }

    // ===========================================================
    // Collapsible panels logic (Left Index & Right TOC)
    // ===========================================================
    const layoutEl = document.getElementById("layout");
    const panelLeft = document.getElementById("panel-left");
    const panelRight = document.getElementById("panel-right");
    const btnLeft = document.getElementById("btn-collapse-left");
    const btnRight = document.getElementById("btn-collapse-right");

    function syncLayoutClasses() {
      const leftCollapsed = panelLeft.classList.contains("collapsed");
      const rightCollapsed = panelRight.classList.contains("collapsed");

      layoutEl.classList.remove("collapse-left", "collapse-right", "collapse-both");
      if (leftCollapsed && rightCollapsed) layoutEl.classList.add("collapse-both");
      else if (leftCollapsed) layoutEl.classList.add("collapse-left");
      else if (rightCollapsed) layoutEl.classList.add("collapse-right");
    }

    function toggleLeftCollapse() {
      const isCollapsed = panelLeft.classList.toggle("collapsed");
      btnLeft.setAttribute("aria-expanded", String(!isCollapsed));
      btnLeft.title = isCollapsed ? "Expand Index" : "Collapse Index";
      syncLayoutClasses();
    }

    function toggleRightCollapse() {
      const isCollapsed = panelRight.classList.toggle("collapsed");
      btnRight.setAttribute("aria-expanded", String(!isCollapsed));
      btnRight.title = isCollapsed ? "Expand TOC" : "Collapse TOC";
      syncLayoutClasses();
    }

    btnLeft.addEventListener("click", toggleLeftCollapse);
    btnRight.addEventListener("click", toggleRightCollapse);

    // Collapse both by default on small screens for more content space
    function responsiveDefaultCollapse() {
      if (window.matchMedia("(max-width: 750px)").matches) {
        if (!panelLeft.classList.contains("collapsed")) toggleLeftCollapse();
        if (!panelRight.classList.contains("collapsed")) toggleRightCollapse();
      }
    }
    window.addEventListener("resize", responsiveDefaultCollapse);

    // ===========================================================
    // Floating Settings menu: Theme switch (Light/Dark + persist)
    // ===========================================================
    const fab = document.getElementById("settings-fab");
    const drawer = document.getElementById("settings-drawer");
    const themeSwitch = document.getElementById("theme-switch");

    function openDrawer(open) {
      drawer.classList.toggle("open", open);
    }
    fab.addEventListener("click", () => {
      const isOpen = drawer.classList.contains("open");
      openDrawer(!isOpen);
    });

    // Theme helpers
    function applyTheme(theme) {
      // theme = "light" | "dark"
      document.documentElement.setAttribute("data-theme", theme);
      const checked = theme === "dark";
      themeSwitch.dataset.checked = String(checked);
      themeSwitch.setAttribute("aria-checked", String(checked));
      localStorage.setItem("theme", theme);
    }

    function initTheme() {
      const saved = localStorage.getItem("theme");
      if (saved === "light" || saved === "dark") {
        applyTheme(saved);
      } else {
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        applyTheme(prefersDark ? "dark" : "light");
      }
    }

    // Toggle by click/keyboard
    function toggleTheme() {
      const current = document.documentElement.getAttribute("data-theme") || "light";
      applyTheme(current === "light" ? "dark" : "light");
    }
    themeSwitch.addEventListener("click", toggleTheme);
    themeSwitch.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        toggleTheme();
      }
    });

    // Close settings when clicking outside
    document.addEventListener("click", (e) => {
      if (!drawer.contains(e.target) && !fab.contains(e.target)) {
        openDrawer(false);
      }
    });

    // ===========================================================
    // Init: build list, theme, responsive defaults, hash handling
    // ===========================================================
    function init() {
      initTheme();
      buildManualList();
      responsiveDefaultCollapse();

      // If URL has a manual ID (#admin-guide), load it; else first
      const initialId = location.hash?.replace("#", "");
      if (initialId && MANUALS_DATA.some(m => m.id === initialId)) {
        loadManualById(initialId);
      } else if (MANUALS_DATA[0]) {
        loadManualById(MANUALS_DATA[0].id);
      }
    }

    window.addEventListener("hashchange", () => {
      const id = location.hash.replace("#", "");
      // If the hash matches a manual, load it; if it's a heading id, let TOC handler manage it
      if (MANUALS_DATA.some(m => m.id === id)) {
        loadManualById(id);
      }
    });

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</

